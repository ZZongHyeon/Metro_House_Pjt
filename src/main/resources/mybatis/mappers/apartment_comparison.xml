
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.boot.apartment_comparison.dao.ApartmentComparisonDAO">
 

<select id="getFavoriteListByUserNumber" parameterType="map" resultType="com.boot.apartment_comparison.dto.ApartmentComparisonDTO">
    SELECT DISTINCT
        f.FAVORITEID as favoriteId,
        f.USERNUMBER as userNumber,
        f.CREATEDAT as createdAt,
        f.LAT as lat,
        f.LNG as lng,
        f.DEALAMOUNT as dealAmount,
MAX(i.APARTMENTID) as apartmentId,
        MAX(i.APTNM) as aptNm,
        MAX(i.ESTATEAGENTSGGNM) as estateAgentSggNm,
        MAX(i.EXCLUUSEAR) as excluUseAr,
        MAX(i.FLOOR) as floor,
        MAX(i.BUILDYEAR) as buildYear,
        MAX(i.SUBWAYSTATION) as subwayStation,
        MAX(i.SUBWAYDISTANCE) as subwayDistance
    FROM 
        APARTMENT_FAVORITE f
    LEFT JOIN 
        APARTMENTINFO i ON (
            ABS(f.LAT - i.LAT) &lt; 0.0000001
            AND ABS(f.LNG - i.LNG) &lt; 0.0000001
            AND f.DEALAMOUNT = i.DEALAMOUNT
        )
    WHERE 
        f.USERNUMBER = 15
GROUP BY 
        f.FAVORITEID, f.USERNUMBER, f.CREATEDAT, f.LAT, f.LNG, f.DEALAMOUNT
    ORDER BY 
        f.CREATEDAT DESC
</select>

</mapper>

